<!DOCTYPE html>
<html>
    <head>
        <title>Caspers Movie Page</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>
    <body>
        <h1>Caspers Movie Page</h1>
        <h3>Deployed by Travis</h3>
        
        <h4>Get Movie</h4>
        <form action="#" id="formGetMovie" onsubmit="fetchGetMovie();">
            <input type="text" id="id">
            <button type="submit" id="btnGetMovie">Get Movie</button>
        </form>
        
        <div id="divSingleMovie">
            <p id="displayId"></p>
            <p id="displayName"></p>
            <p id="displayYear"></p>
            <p id="displayActors"></p>
        </div>
        
        <h4>Add Movie</h4>
        <form action="#" id="formAddMovie" onsubmit="fetchAddMovie();">
            Name: <input type="text" id="name">
            Year: <input type="text" id="year">
            Actors: <input type="text" id="actors">
            <button type="submit" id="btnAddMovie">Add Movie</button>
        </form>
        
        <h4>Show All Movies</h4>
        <button id="btnGetAllMovies">Show All Movies</button>
        <div id="divAllMovies">
            <ul id="ulAllMovies">
                
            </ul>
        </div>
        
        <script>
            document.getElementById("btnGetAllMovies").addEventListener("click", function() {
                fetch("https://lecasper.dk/travis-movies-flow1-week3/api/movie/all")
                        .then(res => res.json())
                        .then(data => {
                            data.forEach(item => function() {
                                console.log(item);
                                var li = document.createElement("li");
                                li.appendChild(document.createTextNode(item.name));
                                document.getElementById("ulAllMovies").appendChild(li);
                            });
                });
            });
            function fetchGetMovie() {
                event.preventDefault();
                var id = document.getElementById("id").value;
                fetch("https://lecasper.dk/travis-movies-flow1-week3/api/movie/" + id)
                .then(res => res.json())
                .then(data => {
                    document.getElementById("displayId").innerHTML = "Id: " + data.id;
                    document.getElementById("displayName").innerHTML = "Name: " + data.name;
                    document.getElementById("displayYear").innerHTML = "Year: " + data.year;
                    document.getElementById("displayActors").innerHTML = "Name: " + data.actors.join();
                    console.log(data);
                });
            }
            
            function fetchAddMovie() {
                event.preventDefault();
                var url = "https://lecasper.dk/travis-movies-flow1-week3/api/movie";
                var yearInput, nameInput, actorsInput;
                yearInput = document.getElementById("year").value;
                nameInput = document.getElementById("name").value;
                actorsInput = document.getElementById("actors").value.replace(/\s/g, "");
                var actorsArr = actorsInput.split(',');
                var movie = {year: yearInput, name: nameInput, actors: actorsArr};
                //console.log(movie);
                
                fetch(url, {
                    method: 'POST',
                    body: JSON.stringify(movie),
                    headers:{
                        'Content-Type': 'application/json',
                        'Access-Control-Allow-Origin': url
                    }
                })
                .then(res => res.json())
                .then(response => console.log('Success: ', JSON.stringify(response)))
                .catch(error => console.error('Error: ', error));
            }
        </script>
    </body>
</html>
